<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="main.css">
    <script src="https://code.jquery.com/jquery-2.2.4.js" integrity="sha256-iT6Q9iMJYuQiMWNd9lDyBUStIq/8PuOW33aOqmvFpqI=" crossorigin="anonymous"></script>
  </head>
 
  <body>
    <div class="container">
    <div class="container" id="header-div">
    </div>
      <div class="container" id="main">
        <img id="mic" src="/images/mic.png">

        <iframe id="spotifyPlayer" frameborder="0" allowtransparency="true" width="800px" src="https://embed.spotify.com/?uri=spotify:trackset:PREFEREDTITLE:2xmJNIkGmYBVoiu1WqA9il"></iframe>
        <table id="mainPlaylist" class="table table-striped col-md-12" >
          <thead>
            <tr>
              <th class="text-center">Track Name</th>
              <th class="text-center">Artist</th>
              <th class="text-center sort-default">Votes</th>  
            </tr>
          </thead>
          <tbody id="mainPlaylistRow">
          </tbody>
        </table>  
      </div>
  </div>
<script>
  // Load all songs from database on page load and build initial table 
  $(document).ready(function(){
     $.getJSON({
      url: '/songs',
      success: function(response){
        response.forEach(function(json){
          var row = `<tr id="${json.track_id}">
                     <td class="text-center">${json.track_name}</td>
                     <td class="text-center">${json.track_artist}</<td>
                     <td class="text-center">${json.votes}</td>
                     </tr>`;
          $('#mainPlaylistRow').append(row)
        })
      }
    });
  })
</script>
<script src='/socket.io/socket.io.js'></script> 
<script></script>
<script>
  var socket = io();

  socket.on('broadcast track', function(track_id, track_name, artist){
    var row = `<tr id="${track_id}">
               <td class="text-center">${track_name}</td>
               <td class="text-center">${artist}</<td>
               <td class="text-center">0</td>
               </tr>`;
    $('#mainPlaylistRow').append(row)
  })

  socket.on('increase votes', function(track_id){
    id = $(`#${track_id}`).children().last().html();
    id = Number(id) + 1 
    $(`#${track_id}`).children().last().html(id)
    sort.refresh()
  })

  socket.on('decrease votes', function(track_id){
    id = $(`#${track_id}`).children().last().html();
    id = Number(id) - 1 
    $(`#${track_id}`).children().last().html(id)
    sort.refresh()
  })

  socket.on('fetch tracks', function(){
    socket.emit('give tracks', mainPlaylistVariable)
  })



</script>
<script src="tablesort.min.js"></script>
<script src="tablesort.number.js"></script>
<script>
  sort = new Tablesort(document.getElementById('mainPlaylist'), {
    descending: true
  });
</script>
</body>
</html>


